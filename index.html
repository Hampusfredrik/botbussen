<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anamnes – Ländrygg: Röda flagg</title>
  <style>
    :root{
      --bg:#f7f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:#e2e8f0;
      --ring:#334155;
      --accent:#111827;
      --accent-contrast:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: 16px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }
    .container{max-width:880px; margin:0 auto; padding:24px 16px 64px}
    h1{font-size:clamp(22px, 3vw, 30px); margin:0 0 6px; letter-spacing:-0.01em}
    p.lead{color:var(--muted); margin:0 0 18px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:20px; box-shadow: 0 6px 18px rgba(15,23,42,.06);}
    .card-body{padding:20px}
    .row{display:flex; gap:12px; align-items:center; padding:10px 0; border-top:1px solid var(--border)}
    .row:first-child{border-top:0}
    .q{flex:1; font-size:15px}
    .btns{display:flex; gap:8px; flex-wrap:wrap}
    button{
      appearance:none; border:1px solid var(--border); background:#fff; color:var(--text);
      padding:8px 14px; border-radius:999px; cursor:pointer; transition:.18s ease; font-weight:600;
    }
    button:hover{transform:translateY(-1px); box-shadow:0 4px 10px rgba(15,23,42,.08)}
    button:focus{outline:none; box-shadow:0 0 0 3px #94a3b8;}
    button[data-variant="primary"], .primary{
      background:var(--accent); color:var(--accent-contrast); border-color:transparent;
    }
    button[data-variant="ghost"]{background:transparent}
    .toolbar{display:flex; gap:10px; align-items:center; margin-top:14px; flex-wrap:wrap}
    .hint{font-size:12px; color:var(--muted)}
    label[for="journal"]{display:block; font-size:14px; color:var(--muted); margin:22px 0 6px}
    textarea{
      width:100%; height:260px; padding:14px; border:1px solid var(--border); border-radius:16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:14px; background:#fff; resize:vertical; box-shadow: 0 4px 12px rgba(15,23,42,.04);
    }
    .footer{margin-top:18px; font-size:12px; color:var(--muted)}
    @media (prefers-color-scheme: dark){
      :root{--bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --ring:#64748b; --accent:#e5e7eb; --accent-contrast:#0b1220}
      button{background:#111827; color:#e5e7eb; border-color:#1f2937}
      textarea{background:#0b1220; border-color:#1f2937}
      .card{box-shadow: 0 10px 24px rgba(0,0,0,.32)}
    }
  </style>
</head>
<body>
  <main class="container">
    <header>
      <h1>Ländrygg: Röda flagg</h1>
      <p class="lead">Kryssa i <strong>Ja</strong> eller <strong>Nej</strong> för varje fråga. Journaltexten skapas automatiskt med en rad per fråga.</p>
    </header>

    <section class="card" aria-labelledby="sektion-fragor">
      <div class="card-body" id="sektion-fragor">
        <div class="rows" id="rows"></div>
        <div class="toolbar">
          <button class="primary" id="copy">Kopiera journaltext</button>
          <button id="reset">Rensa alla svar</button>
          <span class="hint" id="hint">Tips: Obesvarade frågor markeras som "Ej angivet".</span>
        </div>
      </div>
    </section>

    <label for="journal">Journaltext (kopiera och klistra in i din journal)</label>
    <textarea id="journal" readonly></textarea>

    <p class="footer">© <span id="year"></span> Botbussen</p>
  </main>

  <script>
    const QUESTIONS = [
      { key: "blasaTarm", label: "Problem med att kontrollera blåsa eller tarm?" },
      { key: "underlivKansel", label: "Nedsatt känsel underliv?" },
      { key: "tidigareCancer", label: "Tidigare cancer?" },
      { key: "feberSjukdom", label: "Episoder av feber eller sjukdomskänsla senaste 6 månaderna?" },
      { key: "nattligVark", label: "Nattlig värk?" },
      { key: "viktnedgang", label: "Ofrivillig viktnedgång senaste året?" },
      { key: "buksmarta", label: "Nytillkommen buksmärta?" },
      { key: "andfaddhet", label: "Nytillkommen andfåddhet?" },
    ];

    const state = Object.fromEntries(QUESTIONS.map(q => [q.key, ""]))

    const $rows = document.getElementById('rows');
    const $journal = document.getElementById('journal');
    const $copy = document.getElementById('copy');
    const $reset = document.getElementById('reset');

    function renderRows(){
      $rows.innerHTML = '';
      QUESTIONS.forEach(q => {
        const row = document.createElement('div');
        row.className = 'row';

        const qDiv = document.createElement('div');
        qDiv.className = 'q';
        qDiv.textContent = q.label;

        const btns = document.createElement('div');
        btns.className = 'btns';

        const mkBtn = (text, val) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.textContent = text;
          b.addEventListener('click', () => { state[q.key] = val; update(); });
          return b;
        };

        const yes = mkBtn('Ja', 'Ja');
        const no  = mkBtn('Nej', 'Nej');
        const clr = mkBtn('–', ''); clr.setAttribute('title','Rensa denna fråga');

        btns.append(yes, no, clr);
        row.append(qDiv, btns);
        $rows.append(row);
      });
    }

    function buildJournal(){
      const header = '**Ländrygg – Röda flagg**';
      const lines = QUESTIONS.map(q => {
        const v = state[q.key];
        const svar = v === '' ? 'Ej angivet' : v;
        return `${q.label.replace(/\s+/g,' ').trim()} ${svar}`;
      });
      return [header, ...lines].join('\n');
    }

    function updateButtonsState(){
      const rows = $rows.querySelectorAll('.row');
      rows.forEach((row, i) => {
        const q = QUESTIONS[i];
        const buttons = row.querySelectorAll('button');
        const [yes, no, clr] = buttons;
        yes.toggleAttribute('data-variant', state[q.key] === 'Ja' ? 'primary' : null);
        no.toggleAttribute('data-variant', state[q.key] === 'Nej' ? 'primary' : null);
        clr.setAttribute('data-variant', state[q.key] === '' ? 'primary' : 'ghost');
      });
    }

    function update(){
      $journal.value = buildJournal();
      updateButtonsState();
    }

    $copy.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText($journal.value);
        $copy.textContent = 'Kopierat!';
        setTimeout(() => $copy.textContent = 'Kopiera journaltext', 1100);
      }catch(e){
        const ta = document.createElement('textarea');
        ta.value = $journal.value; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      }
    });

    $reset.addEventListener('click', () => {
      Object.keys(state).forEach(k => state[k] = '');
      update();
    });

    document.getElementById('year').textContent = new Date().getFullYear();

    renderRows();
    update();
  </script>
</body>
</html>
